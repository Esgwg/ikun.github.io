{"singlePage": [], "startSite": "", "filingNum": "", "onePageListNum": 15, "commentLabelColor": "#006b75", "yearColorList": ["#bc4c00", "#0969da", "#1f883d", "#A333D0"], "i18n": "CN", "themeMode": "manual", "dayTheme": "light", "nightTheme": "dark", "urlMode": "pinyin", "script": "", "style": "", "head": "", "indexScript": "", "indexStyle": "", "bottomText": "", "showPostSource": 1, "iconList": {}, "UTC": 8, "rssSplit": "sentence", "exlink": {}, "needComment": 1, "allHead": "", "title": "Es", "subTitle": "Welcome to my blog!", "avatarUrl": "https://avatars.githubusercontent.com/u/101002150?v=4", "GMEEK_VERSION": "last", "postListJson": {"P2": {"htmlDir": "docs/post/sui-ji-wai-guo-ren-shen-fen-xin-xi-sheng-cheng.html", "labels": ["Link"], "postTitle": "\u968f\u673a\u5916\u56fd\u4eba\u8eab\u4efd\u4fe1\u606f\u751f\u6210", "postUrl": "post/sui-ji-wai-guo-ren-shen-fen-xin-xi-sheng-cheng.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/2", "commentNum": 0, "wordCount": 45, "description": "[\u968f\u673a\u5916\u56fd\u4eba\u8eab\u4efd\u4fe1\u606f\u751f\u6210](https://www.shenfendaquan.com/)\u3002", "top": 0, "createdAt": 1731421783, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-12", "dateLabelColor": "#bc4c00"}, "P3": {"htmlDir": "docs/post/yu-ming-ce-su-wang-zhan.html", "labels": ["Link"], "postTitle": "\u57df\u540d\u6d4b\u901f\u7f51\u7ad9", "postUrl": "post/yu-ming-ce-su-wang-zhan.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/3", "commentNum": 0, "wordCount": 36, "description": "[\u57df\u540d\u6d4b\u901f\u7f51\u7ad9](https://www.itdog.cn/http/)\u3002", "top": 0, "createdAt": 1731472386, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-13", "dateLabelColor": "#bc4c00"}, "P4": {"htmlDir": "docs/post/VUE-hou-tai-guan-li-xi-tong-mo-ban.html", "labels": ["Link"], "postTitle": "VUE\u540e\u53f0\u7ba1\u7406\u7cfb\u7edf\u6a21\u677f", "postUrl": "post/VUE-hou-tai-guan-li-xi-tong-mo-ban.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/4", "commentNum": 0, "wordCount": 38, "description": "[VUE\u540e\u53f0\u7ba1\u7406\u7cfb\u7edf\u6a21\u677f](http://vue.easydo.work/)\u3002", "top": 0, "createdAt": 1731493534, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-13", "dateLabelColor": "#bc4c00"}, "P5": {"htmlDir": "docs/post/shi-da-jiang-wei-suan-fa.html", "labels": ["Link"], "postTitle": "\u5341\u5927\u964d\u7ef4\u7b97\u6cd5", "postUrl": "post/shi-da-jiang-wei-suan-fa.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/5", "commentNum": 0, "wordCount": 152, "description": "[\u5341\u5927\u964d\u7ef4\u7b97\u6cd5](https://mp.weixin.qq.com/s/H50op3cJHVP5NSK78QsH1Q)\r\n- \u4e3b\u6210\u5206\u5206\u6790\r\n- \u7ebf\u6027\u5224\u522b\u5206\u6790\r\n- \u6838\u4e3b\u6210\u5206\u5206\u6790\r\n- \u72ec\u7acb\u6210\u5206\u5206\u6790\r\n- \u56e0\u5b50\u5206\u6790\r\n- t-SNE\r\n- \u591a\u7ef4\u5c3a\u5ea6\u5206\u6790\r\n- \u81ea\u7f16\u7801\u5668\r\n- \u5c40\u90e8\u7ebf\u6027\u5d4c\u5165\r\n- \u5947\u5f02\u503c\u5206\u89e3\u3002", "top": 0, "createdAt": 1731502821, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-13", "dateLabelColor": "#bc4c00"}, "P6": {"htmlDir": "docs/post/zenodo\uff1a-ke-yan-shu-ju-cun-chu-ku-\uff08-dai-ma-tuo-guan-\uff09.html", "labels": ["Link"], "postTitle": "zenodo\uff1a\u79d1\u7814\u6570\u636e\u5b58\u50a8\u5e93\uff08\u4ee3\u7801\u6258\u7ba1\uff09", "postUrl": "post/zenodo%EF%BC%9A-ke-yan-shu-ju-cun-chu-ku-%EF%BC%88-dai-ma-tuo-guan-%EF%BC%89.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/6", "commentNum": 0, "wordCount": 50, "description": "zenodo\uff1a\u79d1\u7814\u6570\u636e\u5b58\u50a8\u5e93\uff08\u4ee3\u7801\u6258\u7ba1\uff09\u3002", "top": 0, "createdAt": 1731503316, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-13", "dateLabelColor": "#bc4c00"}, "P7": {"htmlDir": "docs/post/zui-qiang-yi-chang-jian-ce-suan-fa-\uff0c-zi-bian-ma-qi- \uff01\uff01\uff1bAutoEncoder.py.html", "labels": ["Link", "Code"], "postTitle": "\u6700\u5f3a\u5f02\u5e38\u68c0\u6d4b\u7b97\u6cd5\uff0c\u81ea\u7f16\u7801\u5668 \uff01\uff01\uff1bAutoEncoder.py", "postUrl": "post/zui-qiang-yi-chang-jian-ce-suan-fa-%EF%BC%8C-zi-bian-ma-qi-%20%EF%BC%81%EF%BC%81%EF%BC%9BAutoEncoder.py.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/7", "commentNum": 0, "wordCount": 17110, "description": "[\u6700\u5f3a\u5f02\u5e38\u68c0\u6d4b\u7b97\u6cd5\uff0c\u81ea\u7f16\u7801\u5668 \uff01\uff01](https://mp.weixin.qq.com/s/wvJM4sKsmCHJGchWJTz8zw)\r\n\uff1b\r\n\r\n```python\r\n'''\r\nautoencoder based anomaly detection model\r\n'''\r\nimport torch\r\nimport torch.nn as nn\r\nimport torch.optim as optim\r\nimport torch.utils.data as Data\r\nimport numpy as np\r\nimport matplotlib.pyplot as plt\r\nfrom sklearn import metrics\r\nimport copy\r\n# plt.switch_backend('Agg')\r\n\r\nfrom general_utils import DEVICE\r\n\r\nepoches = 20\r\nlr = 1e-4\r\nweight_decay = 1.e-7\r\nbatch_size = 1024\r\npercentage = 0.99\r\n\r\ndevice = DEVICE\r\ncriterion = nn.MSELoss()\r\ngetMSEvec = nn.MSELoss(reduction='none')\r\n\r\n\r\nclass autoencoder(nn.Module):\r\n    def __init__(self, feature_size, criter='rmse'): # criter = ['rmse', 'mse'] \r\n        super(autoencoder, self).__init__()\r\n        self.encoder = nn.Sequential(nn.Linear(feature_size, int(feature_size*0.75)),\r\n                                     nn.ReLU(True),\r\n                                     nn.Linear(int(feature_size*0.75), int(feature_size*0.5)),\r\n                                     nn.ReLU(True),\r\n                                     nn.Linear(int(feature_size*0.5),int(feature_size*0.25)),\r\n                                     nn.ReLU(True),\r\n                                     nn.Linear(int(feature_size*0.25),int(feature_size*0.1)))\r\n\r\n        self.decoder = nn.Sequential(nn.Linear(int(feature_size*0.1),int(feature_size*0.25)),\r\n                                     nn.ReLU(True),\r\n                                     nn.Linear(int(feature_size*0.25),int(feature_size*0.5)),\r\n                                     nn.ReLU(True),\r\n                                     nn.Linear(int(feature_size*0.5),int(feature_size*0.75)),\r\n                                     nn.ReLU(True),\r\n                                     nn.Linear(int(feature_size*0.75),int(feature_size)),\r\n                                     )\r\n        \r\n        self.thres = np.Inf\r\n        self.criter = criter\r\n        print(f'NOTICE: use {self.criter} as the criteration of reconstruction error')\r\n\r\n    def forward(self, x):\r\n        encode = self.encoder(x)\r\n        # print('encode', encode)\r\n        decode = self.decoder(encode)\r\n        # print('decode', decode)\r\n        return decode\r\n    \r\n    # update anomaly detection threshold\r\n    def update_thres(self, thres):\r\n        self.thres = thres\r\n\r\n\r\ndef se2rmse(a):\r\n    return torch.sqrt(sum(a.t())/a.shape[1])\r\n\r\ndef train(X_train, feature_size, epoches=epoches, lr=lr, percentage=percentage, weight_decay=weight_decay, verbose=True, thres_criter='rmse'):\r\n    config = {\r\n        'epoches': epoches,\r\n        'lr':lr,\r\n        'percentage':percentage,\r\n        'weight_decay':weight_decay,\r\n        'device':device,\r\n    }\r\n    if verbose:\r\n        print('Hyper parameter config:', config)\r\n        \r\n    model = autoencoder(feature_size, thres_criter).to(device)\r\n    optimizier = optim.Adam(model.parameters(), lr=lr, weight_decay=weight_decay)\r\n    model.train()\r\n\r\n    X_train = torch.from_numpy(X_train).type(torch.float).to(device)\r\n    torch_dataset = Data.TensorDataset(X_train, X_train)\r\n    loader = Data.DataLoader(\r\n        dataset=torch_dataset,\r\n        batch_size=batch_size,\r\n        shuffle=True,\r\n    )\r\n    \r\n    for epoch in range(epoches):\r\n        for step, (batch_x, batch_y) in enumerate(loader):\r\n            output = model(batch_x)\r\n            loss = criterion(output, batch_y)\r\n            optimizier.zero_grad()\r\n            loss.backward()\r\n            optimizier.step()\r\n            # if step % 10 == 0 :\r\n        if verbose:\r\n            print('epoch:{}/{}'.format(epoch,epoches), '|Loss:', loss.item())\r\n    \r\n    model.eval()\r\n    output = model(X_train)\r\n    if thres_criter == 'rmse':\r\n        mse_vec = getMSEvec(output,X_train)\r\n        rmse_vec = se2rmse(mse_vec).cpu().data.numpy()\r\n        if verbose:\r\n            print('max AD score',max(rmse_vec))\r\n        thres = max(rmse_vec)\r\n        rmse_vec.sort()\r\n        pctg = percentage\r\n        thres = rmse_vec[int(len(rmse_vec)*pctg)]\r\n    elif thres_criter == 'mse':\r\n        mse_vec = torch.mean(getMSEvec(X_train, output), dim=1).cpu().data.numpy()\r\n        if verbose:\r\n            print('max AD score',max(mse_vec))\r\n        thres = max(mse_vec)\r\n        mse_vec.sort()\r\n        pctg = percentage\r\n        thres = mse_vec[int(len(mse_vec)*pctg)]\r\n    else:\r\n        print('Unknown criterion for selecting threshold', thres_criter)\r\n        exit(-1)\r\n        \r\n    model.thres = thres\r\n    if verbose:\r\n        print(f'Threshold is: {thres} (at percentage {percentage})' )\r\n\r\n    return model\r\n\r\n# use X_valid to decide the best model\r\ndef train_valid(X_train, feature_size, X_valid, y_valid, \r\n                epoches=epoches, lr=lr, weight_decay=weight_decay, batch_size=batch_size, \r\n                percentage=0.99, thres_criter='rmse', verbose=True, debug=False, opt='Adam'):\r\n    config = {\r\n        'epoches': epoches,\r\n        'lr':lr,\r\n        'percentage':percentage,\r\n        'weight_decay':weight_decay,\r\n        'device':device,\r\n    }\r\n    if verbose:\r\n        print('Hyper parameter config:', config)\r\n        \r\n    model = autoencoder(feature_size, thres_criter).to(device)\r\n    if opt == 'Adam':\r\n        optimizier = optim.Adam(model.parameters(), lr=lr, weight_decay=weight_decay)\r\n    elif opt == 'SGD':\r\n        optimizier = optim.SGD(model.parameters(), lr=lr)\r\n    else: \r\n        raise RuntimeError(f'Unknown optimizier: {opt}')\r\n\r\n    X_train = torch.from_numpy(X_train).type(torch.float).to(device)  \r\n    torch_dataset = Data.TensorDataset(X_train, X_train)\r\n    loader = Data.DataLoader(\r\n        dataset=torch_dataset,\r\n        batch_size=batch_size,\r\n        shuffle=True,\r\n    )\r\n    \r\n    best_model, best_auc, best_thres =  None, -np.Inf, None\r\n\r\n    for epoch in range(epoches):\r\n        model.train()\r\n        for step, (batch_x, batch_y) in enumerate(loader):\r\n            output = model(batch_x)\r\n            loss = criterion(output, batch_y)\r\n            optimizier.zero_grad()\r\n            loss.backward()\r\n            optimizier.step()\r\n        if verbose:\r\n            print('epoch:{}/{}'.format(epoch,epoches), '|Loss:', loss.item())\r\n\r\n        model.eval()\r\n        # get raw threshold for model \r\n        output = model(X_train)\r\n        if thres_criter == 'rmse':\r\n            mse_vec = getMSEvec(output,X_train)\r\n            rmse_vec = se2rmse(mse_vec).cpu().data.numpy()\r\n            thres = max(rmse_vec)\r\n            rmse_vec.sort()\r\n            pctg = percentage\r\n            thres = rmse_vec[int(len(rmse_vec)*pctg)]\r\n        elif thres_criter == 'mse':\r\n            mse_vec = torch.mean(getMSEvec(X_train, output), dim=1).cpu().data.numpy()\r\n            thres = max(mse_vec)\r\n            mse_vec.sort()\r\n            pctg = percentage\r\n            thres = mse_vec[int(len(mse_vec)*pctg)]\r\n        else:\r\n            print('Unknown criterion for selecting threshold', thres_criter)\r\n            exit(-1)\r\n        model.thres = thres\r\n\r\n        _, y_valid_rmse = test(model, X_valid)\r\n        roc_auc, o_thres = eval_roc(y_valid_rmse, y_valid, thres_max=model.thres*1.5, plot=False, verbose=False)\r\n        if roc_auc > best_auc:\r\n            best_auc = roc_auc\r\n            best_thres = o_thres\r\n            best_model = copy.deepcopy(model)\r\n            model.thres = best_thres\r\n            y_valid_pred, _ = test(model, X_valid)\r\n            tpr, fpr = TPR_FPR(y_valid_pred, y_valid, model.thres, verbose=False)\r\n            if verbose: print(f'- update model! valid: roc auc is {best_auc:.5f}, tpr: {tpr:.5f}, fpr:{fpr:.5f}')\r\n        elif debug:\r\n            y_valid_pred, _ = test(model, X_valid)\r\n            tpr, fpr = TPR_FPR(y_valid_pred, y_valid, o_thres, verbose=False)\r\n            print(f'(- NOT update, valid: roc auc is {roc_auc:.5f}, tpr: {tpr:.5f}, fpr:{fpr:.5f})')\r\n\r\n    if verbose:\r\n        print(f'Threshold is: {model.thres} (at percentage {percentage})' )\r\n\r\n    return best_model\r\n\r\n\r\n\r\ndef train_pos_sampling(X_train_ben, X_train_pos, feature_size, pos_weight = 1.,\r\n                       epoches=epoches, lr=lr, weight_decay=weight_decay, batch_size=batch_size, \r\n                       percentage=0.99, thres_criter='rmse', verbose=True, debug=False, opt='Adam',\r\n                       X_valid = None, y_valid = None, # if not None, will use validation set to choose best model\r\n                       ):\r\n    # clip to make sure X_train_pos and X_train_ben is with the same size\r\n    if len(X_train_pos) >= len(X_train_ben):\r\n        X_train_pos = X_train_pos[:len(X_train_ben)]\r\n    else:\r\n        repeats = -(-len(X_train_ben)//len(X_train_pos))\r\n        X_train_pos = np.tile(X_train_pos, (repeats, 1))\r\n        X_train_pos = X_train_pos[:len(X_train_ben)]\r\n\r\n    config = {\r\n        'epoches': epoches,\r\n        'lr':lr,\r\n        'percentage':percentage,\r\n        'weight_decay':weight_decay,\r\n        'device':device,\r\n    }\r\n    if verbose:\r\n        print('Hyper parameter config:', config)\r\n        \r\n    model = autoencoder(feature_size, thres_criter).to(device)\r\n    if opt == 'Adam':\r\n        optimizier = optim.Adam(model.parameters(), lr=lr, weight_decay=weight_decay)\r\n    elif opt == 'SGD':\r\n        optimizier = optim.SGD(model.parameters(), lr=lr)\r\n    else: \r\n        raise RuntimeError(f'Unknown optimizier: {opt}')\r\n\r\n    X_train_ben = torch.from_numpy(X_train_ben).type(torch.float).to(device)\r\n    X_train_pos = torch.from_numpy(X_train_pos).type(torch.float).to(device)\r\n\r\n    torch_dataset = Data.TensorDataset(X_train_ben, X_train_pos)\r\n    loader = Data.DataLoader(\r\n        dataset=torch_dataset,\r\n        batch_size=batch_size,\r\n        shuffle=True,\r\n    )\r\n    \r\n    best_model, best_auc, best_thres =  None, -np.Inf, None\r\n    Bound = nn.ReLU()\r\n    MAX_THRES = 4.\r\n    \r\n    for epoch in range(epoches):\r\n        model.train()\r\n        for step, (batch_x_neg, batch_x_pos) in enumerate(loader):\r\n            output_neg = model(batch_x_neg)\r\n            loss_neg = criterion(output_neg, batch_x_neg)\r\n            output_pos = model(batch_x_pos)\r\n            loss_pos = Bound(MAX_THRES-criterion(output_pos, batch_x_pos))\r\n            loss = loss_neg + pos_weight * loss_pos\r\n            optimizier.zero_grad()\r\n            loss.backward()\r\n            optimizier.step()\r\n\r\n        if verbose:\r\n            print('epoch:{}/{}'.format(epoch,epoches), '|Loss:', loss.item(), f'(neg: {loss_neg.item()}, pos:{loss_pos.item()})')\r\n\r\n        if (X_valid is not None and y_valid is not None) or (epoch == epoches-1):\r\n            model.eval()\r\n            # get raw threshold for model \r\n            output = model(X_train_ben)\r\n            if thres_criter == 'rmse':\r\n                mse_vec = getMSEvec(output,X_train_ben)\r\n                rmse_vec = se2rmse(mse_vec).cpu().data.numpy()\r\n                thres = max(rmse_vec)\r\n                rmse_vec.sort()\r\n                pctg = percentage\r\n                thres = rmse_vec[int(len(rmse_vec)*pctg)]\r\n            elif thres_criter == 'mse':\r\n                mse_vec = torch.mean(getMSEvec(X_train_ben, output), dim=1).cpu().data.numpy()\r\n                thres = max(mse_vec)\r\n                mse_vec.sort()\r\n                pctg = percentage\r\n                thres = mse_vec[int(len(mse_vec)*pctg)]\r\n            else:\r\n                print('Unknown criterion for selecting threshold', thres_criter)\r\n                exit(-1)\r\n            model.thres = thres\r\n\r\n        if X_valid is not None and y_valid is not None:\r\n            _, y_valid_rmse = test(model, X_valid)\r\n            roc_auc, o_thres = eval_roc(y_valid_rmse, y_valid, thres_max=model.thres*1.5, plot=False, verbose=False)\r\n            if roc_auc > best_auc:\r\n                best_auc = roc_auc\r\n                best_thres = o_thres\r\n                best_model = copy.deepcopy(model)\r\n                model.thres = best_thres\r\n                y_valid_pred, _ = test(model, X_valid)\r\n                tpr, fpr = TPR_FPR(y_valid_pred, y_valid, model.thres, verbose=False)\r\n                if verbose: print(f'- update model! valid: roc auc is {best_auc:.5f}, tpr: {tpr:.5f}, fpr:{fpr:.5f}')\r\n            elif debug:\r\n                y_valid_pred, _ = test(model, X_valid)\r\n                tpr, fpr = TPR_FPR(y_valid_pred, y_valid, o_thres, verbose=False)\r\n                print(f'(- NOT update, valid: roc auc is {roc_auc:.5f}, tpr: {tpr:.5f}, fpr:{fpr:.5f})')\r\n        else:\r\n            best_model = model\r\n\r\n    if verbose:\r\n        print(f'Threshold is: {model.thres} (at percentage {percentage})' )\r\n\r\n    return best_model\r\n\r\n\r\n@torch.no_grad()\r\ndef test(model, X_test, thres=None):\r\n    if thres is None:\r\n        thres = model.thres \r\n    model.eval()\r\n    X_test = torch.from_numpy(X_test).type(torch.float)    \r\n    X_test = X_test.to(device)\r\n    output = model(X_test)\r\n    if model.criter == 'rmse':\r\n        mse_vec = getMSEvec(output,X_test)\r\n        rmse_vec = se2rmse(mse_vec).cpu().data.numpy()\r\n        idx_mal = np.where(rmse_vec>thres)\r\n        ano_score = rmse_vec\r\n    elif model.criter == 'mse':\r\n        mse_vec = torch.mean(getMSEvec(X_test, output), dim=1).cpu().data.numpy()\r\n        idx_mal = np.where(mse_vec>thres)\r\n        ano_score = mse_vec\r\n    else:\r\n        raise NotImplementedError\r\n    \r\n     \r\n    y_pred = np.asarray([0] * len(ano_score))\r\n    y_pred[idx_mal] = 1\r\n\r\n    return y_pred, ano_score\r\n\r\n\r\ndef test_plot(rmse_vec, thres, file_name = None, label = None):\r\n    plt.figure()\r\n    plt.plot(np.linspace(0,len(rmse_vec)-1,len(rmse_vec)),[thres]*len(rmse_vec),c='black',label='99th-threshold')\r\n    # plt.ylim(0,thres*2.)\r\n\r\n    if label is not None:\r\n        idx = np.where(label==0)[0]\r\n        plt.scatter(idx, rmse_vec[idx], s=8, color='blue', alpha=0.4, label='Normal')\r\n        \r\n        idx = np.where(label==1)[0]\r\n        plt.scatter(idx, rmse_vec[idx], s=8, color='red', alpha=0.7, label='Anomalies')\r\n    else:\r\n        plt.scatter(np.linspace(0,len(rmse_vec)-1,len(rmse_vec)),rmse_vec,s=8,alpha=0.4, label='Test samples' )\r\n    \r\n    plt.legend()\r\n    plt.xlabel('Sample NO.')\r\n    plt.ylabel('Anomaly Score (RMSE)')\r\n    plt.title('Per-sample Score')\r\n    if file_name is None:\r\n        plt.show()\r\n    else:\r\n        plt.rcParams.update({'figure.dpi':300})\r\n        plt.savefig(file_name)\r\n\r\n\r\n\r\ndef TPR_FPR(y_prob, y_true, thres, verbose=True): \r\n    y_true = np.asarray(y_true)\r\n    y_prob = np.asarray(y_prob)\r\n    y_pred = np.where(y_prob >= thres, 1, 0)\r\n\r\n    fp = np.sum((y_pred == 1) & (y_true == 0))\r\n    tp = np.sum((y_pred == 1) & (y_true == 1))\r\n    fn = np.sum((y_pred == 0) & (y_true == 1))\r\n    tn = np.sum((y_pred == 0) & (y_true == 0))\r\n\r\n    fpr = (fp / (fp + tn + 1e-10))\r\n    tpr = (tp / (tp + fn + 1e-10))\r\n    \r\n    if verbose:\r\n        print('TPR:', tpr, 'FPR:', fpr,)\r\n        print('TN:', tn, 'TP:', tp, 'FP:', fp, 'FN:', fn)\r\n        \r\n    return tpr, fpr\r\n\r\n\r\ndef multi_fpr_tpr(y_prob, y_true, thres_max, thres_min=0, split = 300, is_P_mal=True): \r\n    y_true = np.asarray(y_true)\r\n    y_prob = np.asarray(y_prob)\r\n    fpr = []\r\n    tpr = []\r\n\r\n    thresholds = np.linspace(thres_min, thres_max, split)\r\n    for threshold in thresholds:\r\n        if is_P_mal: \r\n            y_pred = np.where(y_prob >= threshold, 1, 0)\r\n        else:\r\n            y_pred = np.where(y_prob <= threshold, 1, 0)\r\n\r\n        fp = np.sum((y_pred == 1) & (y_true == 0))\r\n        tp = np.sum((y_pred == 1) & (y_true == 1))\r\n\r\n        fn = np.sum((y_pred == 0) & (y_true == 1))\r\n        tn = np.sum((y_pred == 0) & (y_true == 0))\r\n\r\n        # print('fp+tn', fp+tn, 'tp + fn', tp + fn)\r\n        fpr.append(fp / (fp + tn))\r\n        tpr.append(tp / (tp + fn))\r\n\r\n    return fpr, tpr, thresholds\r\n\r\ndef eval_roc(probs, labels, thres_max, thres_min=0, split=300, is_P_mal=True, plot=True, verbose=True):\r\n    fprs, tprs, thresholds = multi_fpr_tpr(probs, labels, thres_max, thres_min=thres_min, split=split, is_P_mal=is_P_mal)\r\n    roc_auc = metrics.auc(fprs, tprs)\r\n    if verbose: print('roc_auc:',roc_auc)\r\n    \r\n    if plot:\r\n        plt.figure()\r\n        plt.title('Receiver Operating Characteristic')\r\n        plt.plot(fprs, tprs, 'b', label = 'AUC = %0.2f' % roc_auc)\r\n        plt.legend(loc = 'lower right')\r\n        plt.xlim([0, 1])\r\n        plt.ylim([0, 1])\r\n        plt.ylabel('True Positive Rate')\r\n        plt.xlabel('False Positive Rate')\r\n        plt.show()\r\n    \r\n    optimal_idx = np.argmax(np.asarray(tprs) - np.asarray(fprs))\r\n    optimal_threshold = thresholds[optimal_idx]\r\n    return roc_auc, optimal_threshold\r\n\r\nclass Normalizer:\r\n    def __init__(self, train_data, clip=False, delta=1e-10):\r\n        self.train_min = np.min(train_data, axis=0)\r\n        self.train_max = np.max(train_data, axis=0)\r\n        self.clip = clip\r\n        self.delta = delta\r\n\r\n    def transform(self, data):\r\n        return (data - self.train_min) / (self.train_max - self.train_min + self.delta)\r\n\r\n    def denorm(self, data):\r\n        return data * (self.train_max - self.train_min) + self.train_min\r\n\r\n    def denorm_query(self, index, norm_value):\r\n        range = self.train_max[index] - self.train_min[index]\r\n        return norm_value * range + self.train_min[index]\u3002", "top": 0, "createdAt": 1731513557, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-13", "dateLabelColor": "#bc4c00"}, "P8": {"htmlDir": "docs/post/IP-di-zhi-cha-xun.html", "labels": ["Link"], "postTitle": "IP\u5730\u5740\u67e5\u8be2", "postUrl": "post/IP-di-zhi-cha-xun.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/8", "commentNum": 0, "wordCount": 82, "description": "[\u5355\u4e2aIP\u5730\u5740\u67e5\u8be2](https://www.qqzeng.com/ip/)\r\n[\u591a\u4e2a/\u5355\u4e2aIP\u5730\u5740\u67e5\u8be2](https://uutool.cn/ip-batch/)\u3002", "top": 0, "createdAt": 1731592191, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-14", "dateLabelColor": "#bc4c00"}, "P9": {"htmlDir": "docs/post/zai-xian-yun-xing-MATLAB-dai-ma.html", "labels": ["Link"], "postTitle": "\u5728\u7ebf\u8fd0\u884cMATLAB\u4ee3\u7801", "postUrl": "post/zai-xian-yun-xing-MATLAB-dai-ma.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/9", "commentNum": 0, "wordCount": 72, "description": "[\u5728\u7ebf\u8fd0\u884cMATLAB\u4ee3\u7801](https://www.tutorialspoint.com/execute_matlab_online.php)\u3002", "top": 0, "createdAt": 1731748012, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-16", "dateLabelColor": "#bc4c00"}, "P10": {"htmlDir": "docs/post/Lightly- -zai-xian-yun-xing-duo-zhong-dai-ma.html", "labels": ["Link"], "postTitle": "Lightly: \u5728\u7ebf\u8fd0\u884c\u591a\u79cd\u4ee3\u7801", "postUrl": "post/Lightly-%20-zai-xian-yun-xing-duo-zhong-dai-ma.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/10", "commentNum": 0, "wordCount": 141, "description": "[\u5728\u7ebf\u8fd0\u884c\u591a\u79cd\u4ee3\u7801](https://lightly.teamcode.com/dashboard)\r\n![image](https://github.com/user-attachments/assets/9d7c685f-f4e3-4388-b273-6410d0d08f63)\u3002", "top": 0, "createdAt": 1731748061, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-16", "dateLabelColor": "#bc4c00"}, "P11": {"htmlDir": "docs/post/UU-zai-xian-gong-ju-\u2014\u2014-duo-kuan-wen-ben-\u3001-bian-cheng-\u3001-shu-xue-\u3001-tu-xiang-\u3001-wen-jian-zhuan-huan-\u3001-yin-shi-pin-da-deng-gong-ju.html", "labels": ["Link"], "postTitle": "UU\u5728\u7ebf\u5de5\u5177\u2014\u2014\u591a\u6b3e\u6587\u672c\u3001\u7f16\u7a0b\u3001\u6570\u5b66\u3001\u56fe\u50cf\u3001\u6587\u4ef6\u8f6c\u6362\u3001\u97f3\u89c6\u9891\u6253\u7b49\u5de5\u5177", "postUrl": "post/UU-zai-xian-gong-ju-%E2%80%94%E2%80%94-duo-kuan-wen-ben-%E3%80%81-bian-cheng-%E3%80%81-shu-xue-%E3%80%81-tu-xiang-%E3%80%81-wen-jian-zhuan-huan-%E3%80%81-yin-shi-pin-da-deng-gong-ju.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/11", "commentNum": 0, "wordCount": 28, "description": "[UU\u5728\u7ebf\u5de5\u5177](https://uutool.cn/)\u3002", "top": 0, "createdAt": 1731827605, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-17", "dateLabelColor": "#bc4c00"}, "P12": {"htmlDir": "docs/post/ke-jie-shi-xing-ji-qi-xue-xi-\u2014\u2014SHAP.html", "labels": ["Link"], "postTitle": "\u53ef\u89e3\u91ca\u6027\u673a\u5668\u5b66\u4e60\u2014\u2014SHAP", "postUrl": "post/ke-jie-shi-xing-ji-qi-xue-xi-%E2%80%94%E2%80%94SHAP.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/12", "commentNum": 0, "wordCount": 67, "description": "[\u53ef\u89e3\u91ca\u6027\u673a\u5668\u5b66\u4e60\u2014\u2014SHAP](https://mp.weixin.qq.com/s/4mz63XmNu0qqEB1ZUitkIA)\u3002", "top": 0, "createdAt": 1732089429, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-20", "dateLabelColor": "#bc4c00"}, "P13": {"htmlDir": "docs/post/XGBoost.html", "labels": ["Link", "Code"], "postTitle": "XGBoost", "postUrl": "post/XGBoost.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/13", "commentNum": 0, "wordCount": 60, "description": "[XGBoost](https://mp.weixin.qq.com/s/8Fnm_YbtuqfPAsedqwBtxw)\u3002", "top": 0, "createdAt": 1732117267, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-20", "dateLabelColor": "#bc4c00"}, "P14": {"htmlDir": "docs/post/te-zheng-xuan-ze-fang-fa.html", "labels": ["Link"], "postTitle": "\u7279\u5f81\u9009\u62e9\u65b9\u6cd5", "postUrl": "post/te-zheng-xuan-ze-fang-fa.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/14", "commentNum": 0, "wordCount": 59, "description": "[\u7279\u5f81\u9009\u62e9\u65b9\u6cd5](https://mp.weixin.qq.com/s/aAbVoLH789Z22sH0S5Wwpg)\u3002", "top": 0, "createdAt": 1732251487, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-22", "dateLabelColor": "#bc4c00"}, "P15": {"htmlDir": "docs/post/GBDT\u3001XGBoost\u3001LightGBM\uff0c-shu-mo-xing-quan-mian-dui-bi- \uff01\uff01.html", "labels": ["Link", "Code"], "postTitle": "GBDT\u3001XGBoost\u3001LightGBM\uff0c\u6811\u6a21\u578b\u5168\u9762\u5bf9\u6bd4 \uff01\uff01", "postUrl": "post/GBDT%E3%80%81XGBoost%E3%80%81LightGBM%EF%BC%8C-shu-mo-xing-quan-mian-dui-bi-%20%EF%BC%81%EF%BC%81.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/15", "commentNum": 0, "wordCount": 85, "description": "[GBDT\u3001XGBoost\u3001LightGBM\uff0c\u6811\u6a21\u578b\u5168\u9762\u5bf9\u6bd4 \uff01\uff01](https://mp.weixin.qq.com/s/LwCNJP3Z51Hn2aclSvYQ_w)\u3002", "top": 0, "createdAt": 1732517981, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-25", "dateLabelColor": "#bc4c00"}, "P16": {"htmlDir": "docs/post/xin- SHAP -tu-\uff1aViolin -he- Heatmap.html", "labels": ["Link", "Code"], "postTitle": "\u65b0 SHAP \u56fe\uff1aViolin \u548c Heatmap", "postUrl": "post/xin-%20SHAP%20-tu-%EF%BC%9AViolin%20-he-%20Heatmap.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/16", "commentNum": 0, "wordCount": 78, "description": "[\u65b0 SHAP \u56fe\uff1aViolin \u548c Heatmap](https://mp.weixin.qq.com/s/6RJFjPFqqXrm7XKoFffaig)\u3002", "top": 0, "createdAt": 1732768701, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-28", "dateLabelColor": "#bc4c00"}, "P17": {"htmlDir": "docs/post/zui-qiang-zong-jie-ji-qi-xue-xi-mo-xing-\uff0cAdaboost \uff01\uff01.html", "labels": ["Link", "Code"], "postTitle": "\u6700\u5f3a\u603b\u7ed3\u673a\u5668\u5b66\u4e60\u6a21\u578b\uff0cAdaboost \uff01\uff01", "postUrl": "post/zui-qiang-zong-jie-ji-qi-xue-xi-mo-xing-%EF%BC%8CAdaboost%20%EF%BC%81%EF%BC%81.html", "postSourceUrl": "https://github.com/Esgwg/ikun.github.io/issues/17", "commentNum": 0, "wordCount": 75, "description": "[\u6700\u5f3a\u603b\u7ed3\u673a\u5668\u5b66\u4e60\u6a21\u578b\uff0cAdaboost \uff01\uff01](https://mp.weixin.qq.com/s/dioK6tDNh1LBvSM9z0dy6g)\u3002", "top": 0, "createdAt": 1732768971, "style": "", "script": "", "head": "", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "createdDate": "2024-11-28", "dateLabelColor": "#bc4c00"}}, "singeListJson": {}, "labelColorDict": {"bug": "#d73a4a", "Code": "#71B6A1", "enhancement": "#a2eeef", "good first issue": "#7057ff", "help wanted": "#008672", "invalid": "#e4e669", "Link": "#0075ca", "question": "#d876e3", "wontfix": "#ffffff"}, "displayTitle": "Es", "faviconUrl": "https://avatars.githubusercontent.com/u/101002150?v=4", "ogImage": "https://avatars.githubusercontent.com/u/101002150?v=4", "primerCSS": "<link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />", "homeUrl": "https://Esgwg.github.io/ikun.github.io", "prevUrl": "/index.html", "nextUrl": "disabled"}